<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">

    <changeSet id="1.0.1" author="retmix">
        <createTable schemaName="shop" tableName="roles">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="title" type="varchar(100)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="1.0.2" author="retmix">
        <createTable schemaName="shop" tableName="users">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="email" type="varchar(200)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="surname" type="varchar(100)">
                <constraints nullable="false"/>
            </column>
            <column name="firstname" type="varchar(100)">
                <constraints nullable="false"/>
            </column>
            <column name="lastname" type="varchar(100)">
                <constraints nullable="false"/>
            </column>
            <column name="password" type="varchar(100)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="1.0.3" author="retmix">
        <createTable schemaName="shop" tableName="user_role">
            <column name="id_user" type="bigint">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="id_role" type="bigint">
                <constraints nullable="false" primaryKey="true"/>
            </column>
        </createTable>
    </changeSet>
    
    <changeSet id="1.0.4" author="retmix">
        <createTable schemaName="shop" tableName="products">
            <column name="id" type="bigint" autoIncrement="true">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="title" type="varchar(100)">
                <constraints nullable="true"/>
            </column>
            <column name="description" type="varchar(200)">
                <constraints nullable="false"/>
            </column>
            <column name="price" type="float">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="1.0.5" author="retmix">
        <createTable schemaName="shop" tableName="basket">
            <column name="id_user" type="bigint">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="id_product" type="bigint">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="price_basket" type="float">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="1.0.6" author="retmix">
        <addForeignKeyConstraint baseTableSchemaName="shop"
                                 baseTableName="user_role"
                                 baseColumnNames="id_user"
                                 constraintName="id_userRole_fk"
                                 onDelete="CASCADE"
                                 referencedTableSchemaName="shop"
                                 referencedTableName="users"
                                 referencedColumnNames="id"/>
    </changeSet>

    <changeSet id="1.0.7" author="retmix">
        <addForeignKeyConstraint baseTableSchemaName="shop"
                                 baseTableName="user_role"
                                 baseColumnNames="id_role"
                                 constraintName="id_roleUser_fk"
                                 onDelete="CASCADE"
                                 referencedTableSchemaName="shop"
                                 referencedTableName="roles"
                                 referencedColumnNames="id"/>
    </changeSet>

    <changeSet id="1.0.8" author="retmix">
        <addForeignKeyConstraint referencedTableSchemaName="shop"
                                 baseTableName="basket"
                                 baseColumnNames="id_user"
                                 constraintName="id_userbasket_fk"
                                 onDelete="CASCADE"
                                 baseTableSchemaName="shop"
                                 referencedTableName="users"
                                 referencedColumnNames="id"/>
    </changeSet>

    <changeSet id="1.0.9" author="retmix">
        <addForeignKeyConstraint baseTableSchemaName="shop"
                                 baseTableName="basket"
                                 baseColumnNames="id_product"
                                 constraintName="id_product_fk"
                                 onDelete="CASCADE"
                                 referencedTableSchemaName="shop"
                                 referencedTableName="products"
                                 referencedColumnNames="id"/>
    </changeSet>

    <changeSet id="1.0.10" author="retmix">
        <insert schemaName="shop" tableName="roles">
            <column name="title" value="ROLE_CLIENT"/>
        </insert>

        <insert schemaName="shop" tableName="roles">
            <column name="title" value="ROLE_ADMIN"/>
        </insert>
    </changeSet>

    <changeSet id="1.0.11" author="retmix">
        <insert schemaName="shop" tableName="users">
            <column name="email" value="admin@shop.ru"/>
            <column name="surname" value="Neupokoev"/>
            <column name="firstname" value="Andrey"/>
            <column name="lastname" value="Evgen"/>
            <column name="password" value="QWEasd123"/>
        </insert>

        <insert schemaName="shop" tableName="users">
            <column name="email" value="user@shop.ru"/>
            <column name="surname" value="Eldar"/>
            <column name="firstname" value="Samset"/>
            <column name="lastname" value="Quy"/>
            <column name="password" value="password"/>
        </insert>
    </changeSet>

    <changeSet id="1.0.12" author="retmix">
        <insert schemaName="shop" tableName="products">
            <column name="title" value="Pizza"/>
            <column name="description" value="This is pizza very very tasty"/>
            <column name="price" valueNumeric="128.90"/>
        </insert>

        <insert schemaName="shop" tableName="products">
            <column name="title" value="Muffin"/>
            <column name="description" value="Family is the most important"/>
            <column name="price" valueNumeric="299.99"/>
        </insert>
    </changeSet>

</databaseChangeLog>